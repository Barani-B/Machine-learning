import numpy as np
import pandas as pd
from sklearn.decomposition import TruncatedSVD

# Sample rating matrix
ratings = pd.DataFrame({
    'User': [1,1,1,2,2,3,3],
    'Item': [1,2,3,1,3,2,3],
    'Rating': [5,4,3,4,2,5,4]
})

# Pivot table
rating_matrix = ratings.pivot_table(
    index='User', columns='Item', values='Rating').fillna(0)

# SVD
svd = TruncatedSVD(n_components=2)
matrix_reduced = svd.fit_transform(rating_matrix)

# Reconstruct matrix
predicted_ratings = np.dot(matrix_reduced, svd.components_)
pred_df = pd.DataFrame(predicted_ratings,
                       index=rating_matrix.index,
                       columns=rating_matrix.columns)

print(pred_df)
